---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

// Fetch all notes from the 'notes' collection
const allNotes = await getCollection('notes');

// Sort notes by title if date is not available
allNotes.sort((a, b) => {
  if (a.data.date && b.data.date) {
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  }
  // Fallback to sorting by title
  return a.data.title.localeCompare(b.data.title);
});
---

<Layout title="Blog">
  <div class="blog-content">
    <h1>Blog Posts</h1>
    <ul class="post-list">
      {allNotes.map((note) => (
        <li>
          <a href={`/notes/${note.slug}`} class="post-link">
            <span class="post-title">{note.data.title}</span>
            {note.data.description && <span class="post-description">{note.data.description}</span>}
            {note.data.date && (
              <span class="post-date">
                {new Date(note.data.date).toLocaleDateString()}
              </span>
            )}
          </a>
        </li>
      ))}
    </ul>
  </div>
</Layout>

<style>
  .blog-content {
    color: white;
    padding: 20px;
  }
  .blog-content h1 {
    color: white;
    margin-bottom: 20px;
  }
  .post-list {
    list-style-type: none;
    padding: 0;
  }
  .post-link {
    display: block;
    background-color: #333;
    color: white;
    text-decoration: none;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 5px;
    transition: background-color 0.3s ease;
  }
  .post-link:hover {
    background-color: #444;
  }
  .post-title {
    display: block;
    font-size: 1.2em;
    font-weight: bold;
    margin-bottom: 5px;
  }
  .post-description {
    display: block;
    font-size: 0.9em;
    color: #ccc;
  }
  .post-date {
    display: block;
    font-size: 0.8em;
    color: #999;
    margin-top: 5px;
  }
</style>